% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/06-utils.R
\name{downsampleVariant}
\alias{downsampleVariant}
\title{downsampleVariant: Downsample Cells by Group to Balance Cell Numbers}
\arguments{
\item{max_cells}{Integer. Maximum number of cells to keep from each group. Groups with fewer
cells than this threshold will retain all their cells. Default: 1000.}

\item{group_by}{Character, optional. Metadata column to use for grouping cells. If NULL,
uses the current project identity set by setProjectIdentity(). Default: NULL.}

\item{seed}{Integer. Random seed for reproducible downsampling. Default: 42.}
}
\value{
Returns the modified object invisibly (for method chaining).
}
\description{
Reduces the number of cells in the variantCell object by downsampling each group to a maximum
number of cells. This function is useful for balancing cell numbers across groups, reducing
computational burden, and mitigating the effects of groups with very different cell counts on
downstream analyses.
}
\details{
The function performs downsampling by:
\enumerate{
\item Grouping cells based on the specified metadata column
\item For each group, if cell count exceeds max_cells, randomly selecting max_cells cells to keep
\item Updating all matrices and metadata to include only the selected cells
\item Maintaining consistency across all data structures in the object
}

This operation modifies the object in-place, permanently removing cells that aren't selected.
It's particularly useful when working with imbalanced datasets, where some cell types or
conditions have many more cells than others, which could bias analytical results.

The function automatically handles updates to all relevant data structures, including:
\itemize{
\item Alternative allele (AD) matrix
\item Depth (DP) matrix
\item Normalized depth matrix (if available)
\item Cell metadata
\item Sample-level information
}
}
\note{
\itemize{
\item This function modifies the object in-place (no copy is created)
\item Downsampling is performed randomly for each group
\item The seed parameter ensures reproducibility of random sampling
\item Groups with fewer cells than max_cells will keep all their cells
\item If after downsampling a sample has no remaining cells, it will be removed from the object
\item A detailed summary of the downsampling is printed to the console
}
}
\examples{
\dontrun{
# Basic usage - downsample to 500 cells per cell type
project$setProjectIdentity("cell_type")
project$downsampleVariant(max_cells = 500)

# Downsample by a different grouping variable
project$downsampleVariant(
  max_cells = 200,
  group_by = "condition",
  seed = 123  # Use different seed for different random selection
)

# Use with method chaining
results <- project$downsampleVariant(max_cells = 300)$findDESNPs(
  ident.1 = "T_cells",
  ident.2 = "B_cells"
)
}

}
\seealso{
\code{\link{setProjectIdentity}} for setting the grouping identity
\code{\link{subsetvariantCell}} for other filtering operations
}
